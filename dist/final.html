<html>

<head>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous"></script>
    <script src="gridoo-bundle.js"></script>
    <script src="facetoo-bundle.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.11/handlebars.min.js"></script>
    <link rel="stylesheet" href="https://necolas.github.io/normalize.css/7.0.0/normalize.css" />
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN"
        crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.13/semantic.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.13/semantic.min.js"></script>
    <style>
        .ui.card,
        .ui.menu {
            margin: 0px !important;
        }

        .ui.category.search .results {
            width: 100%;
        }
    </style>
    <script id="entry-template" type="text/x-handlebars-template">
        <div class="ui fluid compact card" style="padding:0px;">
            {{#eachInMap this}}
            <div style="padding: 0px;display:flex" class="content">
                <h5 class="ui category header" style="flex:2;margin:0px;padding:5px;">
                    <a href="#">{{key}}</a>
                    <div class="sub header">{{value.ProjectName}}</div>
                    <div class="sub header">{{value.DemandSourceType}}</div>
                </h5>
                <table style="flex:4;border:none;margin:0px;padding:0px;" class="ui compact very collapsing small table" >
                    <tbody>
                        {{#each value.requests}}
                        <tr>
                            <td><a href="#">{{ResourceRequestId}}</a></td>
                            <td>{{Role}}</td>
                            <td>{{Country}}</td>
                            <td>{{DemandSource}}</td>
                        </tr>
                        {{/each}}
                    </tbody>
                </table>
            </div>
            {{/eachInMap}}
        </div>
      </script>
</head>

<body style="margin: 0px;height:100%;weight:100%;">
    <div style="display: flex;height:100%;weight:100%;overflow: hidden;">
        <div id="facet" style="flex:2;margin-right:1px;"></div>
        <div style="height:100%;overflow: hidden;flex:10;display: flex;flex-direction: column">
            <div class="ui menu" style="display:flex;">
                <div class="item">
                    Dashboard
                </div>
                <div class="item">
                    Queries
                </div>
                <div class="item" style="flex:10;">
                    <select class="ui search dropdown" style="border-right: none;">
                        <option>Role</option>
                        <option>Status</option>
                        <option>Name</option>
                        <option>Id</option>
                        <option>Delivery Country</option>
                    </select>
                    <div id="input-search" class="ui search" style="width: 100%;">
                        <div class="ui icon action input" style="width: 100%;">
                            <input style="border-radius:0px" class="prompt" type="text" placeholder="Search Resource Requests....." />
                            <i class="search icon"></i>
                            <button class="ui blue right labeled icon button">
                                <i class="search icon"></i>
                                Search
                            </button>
                        </div>
                    </div>
                </div>
                <div class="item">
                    <div class="ui medium icon buttons">
                        <button class="ui button">
                            <i class="save icon"></i>
                        </button>
                        <button class="ui button">
                            <i class="file green excel outline icon"></i>
                        </button>
                        <button class="ui button">
                            <i class="share icon"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div id="grid" style="height:100%;overflow: hidden;flex:15;margin-top:1px"></div>
        </div>
    </div>

    <script>
        Handlebars.registerHelper('eachInMap', function (map, block) {
            var out = '';
            Object.keys(map).map(function (prop) {
                out += block.fn({ key: prop, value: map[prop] });
            });
            return out;
        });
        var columns = [
            //{
            //    id: 'Imp', name: 'Imp', renderDefn: true, width: '100',  dropDownEnabled: true, ddFiltersWithSearch: true, hidden: false, widthLocked: true, renderHybrid: false
            //},
            // {
            //     id: 'Notes', name: 'Notes', renderDefn: true, width: '120', locked: true, renderHybrid: false, headTabIndex: -1
            // },
            // {
            //     id: 'RequestTypeEnum', name: 'Req. Type', width: '150',   hidden: false, locked: false
            // },
            {
                id: 'ProjectId', name: 'Project ID', sortable: true, filterable: true, width: '100', hidden: true, locked: false, renderDefn: true, renderHybrid: false,
            },
            {
                id: 'ResourceRequestId', name: 'Request ID', width: '100', primary: true, hidden: false, locked: false, renderDefn: false, renderHybrid: false,
            },
            // {
            //     id: 'DemandSourceId', name: 'Demand Source Id', width: '150',   hidden: false, locked: false, renderDefn: true, renderHybrid: false, 
            // },
            // {
            //     id: 'ReasonCode', name: 'Reason Code', width: '150',   hidden: false, locked: false
            // },
            // {
            //     id: 'Comments', name: 'Comments', width: '150',   hidden: false, locked: false
            // },
            // {
            //     id: 'RequestorName', name: 'Requestor', width: '150',   hidden: false, locked: false
            // },

            {
                id: 'ProjectName', name: 'Project Name', width: '150', hidden: false
            },
            // {
            //     id: 'CustomerName', name: 'Account Name', width: '200',   hidden: false, locked: false
            // },
            {
                id: 'Role', facetable: true, name: 'Req.Role', width: '150', hidden: false
            },
            {
                id: 'DeliveryCountryName', facetable: true, name: 'Delivery Loc. Country', width: '200', hidden: false, locked: false
            },
            {
                id: 'RequestedHours', name: 'Req.Hours', width: '150', hidden: false, renderHybrid: false
            },
            {
                id: 'ResourceRequestStatusEnum', facetable: true, name: 'Status', width: '150', hidden: false, renderHybrid: false
            },
            {
                id: 'ResourceRequestSubStatusEnum', facetable: true, name: 'Sub-Status', width: '150', hidden: false
            },
            {
                id: 'RequestedStartDate', name: 'Req.StartDate', renderDefn: false, columnIsDate: true, columnDatePipe: 'dd-MMM-yyyy, hh:mm a', width: '180', dropDownEnabled: true, ddFiltersWithSearch: true, hidden: false
            },
            {
                id: 'RequestedEndDate', name: 'Req.EndDate', renderDefn: false, columnIsDate: true, columnDatePipe: 'dd-MMM-yyyy, hh:mm a', width: '180', hidden: false
            },
            {
                id: 'CreatedDate', name: 'Submitted Date', renderDefn: false, columnIsDate: true, columnDatePipe: 'dd-MMM-yyyy, hh:mm a', width: '180', dropDownEnabled: true, ddFiltersWithSearch: true, hidden: false
            },
            {
                id: 'RequestDomain', name: 'Pri. Domain', width: '200', hidden: false, locked: false
            },
            {
                id: 'OfferingNameOrPrimarySkill', name: 'Skills', width: '150', hidden: false, locked: false, renderHybrid: false
            },
            {
                id: 'ContractSignatureDate', name: 'Contract Signature Date', renderDefn: false, columnIsDate: true, columnDatePipe: 'dd-MMM-yyyy, hh:mm a', width: '150', hidden: false, locked: false
            },
            {
                id: 'PubSec', name: 'PubSec', width: '150', hidden: false, locked: false, renderHybrid: false
            },
            {
                id: 'DaysOpen', name: 'Days Open', width: '150', hidden: false, locked: false, renderHybrid: false
            },
            {
                id: 'IdleDays', name: 'Idle', width: '150', hidden: false
            },
            {
                id: 'DeliveryState', facetable: true, name: 'Delivery Loc. State', width: '200', hidden: false, locked: false
            },
            {
                id: 'DeliveryCity', facetable: true, name: 'Delivery City', width: '150', hidden: false, locked: false
            },

            {
                id: 'QueueName', name: 'Queue Name', width: '150', hidden: false, locked: false
            },
            {
                id: 'UpdatedDate', name: 'Modified Date', renderDefn: false, columnIsDate: true, columnDatePipe: 'dd-MMM-yyyy, hh:mm a', width: '180', dropDownEnabled: true, ddFiltersWithSearch: true, hidden: false
            },
            {
                id: 'UpdatedBy', name: 'Modified By', hidden: false, locked: false, renderDefn: true, width: '180', renderHybrid: false,
            },
            {
                id: 'CreatedBy', name: 'Submitted By', hidden: false, locked: false, renderDefn: true, width: '180', renderHybrid: false,
            },
            {
                id: 'ContractType', name: 'Contract Type', renderDefn: true, width: '150', hidden: false, locked: false
            },
            {
                id: 'ResourceManagerName', facetable: true, name: 'Resource Manager', width: '180', hidden: false, locked: false
            },
            {
                id: 'LastStatusUpdatedDate', name: 'Last Updated', renderDefn: false, columnIsDate: true, columnDatePipe: 'dd-MMM-yyyy, hh:mm a', width: '180', hidden: true, locked: false
            },
            {
                id: 'AssignedResourceName', name: 'Committed Resource', width: '150', hidden: false, locked: false, renderDefn: true, renderHybrid: false,
            },
            {
                id: 'FundingTypeEnum', name: 'Fund. Type', width: '150', hidden: false, locked: false
            },
            {
                id: 'ScheduledStartDate', name: 'Sched.StartDate', renderDefn: false, columnIsDate: true, columnDatePipe: 'dd-MMM-yyyy, hh:mm a', width: '180', dropDownEnabled: true, ddFiltersWithSearch: true, hidden: false
            },
            {
                id: 'ScheduledEndDate', name: 'Sched.EndDate', renderDefn: false, columnIsDate: true, columnDatePipe: 'dd-MMM-yyyy, hh:mm a', width: '180', dropDownEnabled: true, ddFiltersWithSearch: true, hidden: false
            },
            {
                id: 'CBTFlag', name: 'CBT', width: '100', hidden: false, locked: false
            }
        ];
        var facets = [
            {
                id: 'Role', facetable: true, name: 'Req.Role', width: '150', hidden: false
            },
            {
                id: 'DeliveryCountryName', facetable: true, name: 'Delivery Loc. Country', width: '200', hidden: false, locked: false
            },
            {
                id: 'ResourceRequestStatusEnum', facetable: true, name: 'Status', width: '150', hidden: false, renderHybrid: false
            },
            {
                id: 'ResourceRequestSubStatusEnum', facetable: true, name: 'Sub-Status', width: '150', hidden: false
            },
            {
                id: 'ResourceManagerName', facetable: true, name: 'Resource Manager', hidden: false, locked: false
            }
        ];
        var renderFunction = function (col, row) {

        }
        var onClickHeader = function (col, diretion) {
            alert('hi on click Header - ' + col + ' ' + diretion);
        }
        var onClickFilter = function (col, value, action) {
            alert('hi on click filter - ' + col + ' ' + value + ' ' + action);
        }
        var onPageSearch = function (pageIndex, pageSize) {
            alert('hi on click filter - ' + pageIndex + ' ' + pageSize);
        }
        var renderFunction = function (col, row) {

        }
        var onFilterChange = function (col, value, action) {
            alert('From Facetoo - ' + col + ' ' + value + ' ' + action);
        }
        var onAllFilterRemove = function (pageIndex, pageSize) {
            alert('From Facetoo - ' + pageIndex + ' ' + pageSize);
        }
        var options = {
            columns: columns,
            hybridFunction: renderFunction,
            onClickHeader: onClickHeader,
            onClickFilter: onClickFilter,
            onPageSearch: onPageSearch,
            containerElement: document.getElementById('grid'),
        }
        var grid = new Gridoo.Grid(options);

        var data = [];
        for (var i = 0; i < 1000; i++) {
            data.push({
                ProjectId: "ProjectId" + i,
                ResourceRequestId: "" + i,
                CBTFlag: "CBTFlag" + i,
                DeliveryCountryName: "DeliveryCountryName" + i,
                ScheduledEndDate: "ScheduledEndDate" + i,
                DeliveryCity: "DeliveryCity" + i,
                ScheduledStartDate: "ScheduledStartDate" + i,
                FundingTypeEnum: "FundingTypeEnum" + i,
            })
        }
        var html = grid.bindData(data, {
            totalCount: 34345,
            pageSize: 1000,
            pageIndex: 1,
            pageSizes: [50, 100, 200, 500, 1000]
        });
        var facetValue = [];
        for (let i = 0; i < 10; i++) {
            facetValue.push({
                count: 10 + i,
                label: "Label" + i,
                selected: i === 2 || i == 1,
            });
        }

        var filter = [];
        filter.push({
            filterKey: "city",
            filterName: "City",
            filterValues: ["Pune", "Mumbai"]
        }, {
                filterKey: "Country",
                filterName: "Country",
                filterValues: ["India", "Pakistan"]
            }, {
                filterKey: "Role",
                filterName: "Role",
                filterValues: ["Label2", "Label1"]
            });
        facetsData = facets.map((facetMeta) => {
            return {
                facetMeta,
                facetRange: {
                    max: "",
                    min: "",
                },
                facetValues: facetValue,
            };
        });
        var options = {
            facets: facets,
            onAllFilterRemove: onAllFilterRemove,
            onFilterChange: onFilterChange,
            containerElement: document.getElementById('facet'),
        }
        var facet = new Facetoo.Facet(options);
        facet.Bind(facetsData, filter);
        $(".ui.search.dropdown").dropdown();
        var source = document.getElementById("entry-template").innerHTML;
        var template = Handlebars.compile(source);
        $('#input-search')
            .search({
                type: 'category',
                minCharacters: 3,
                onSelect: function(result, response){
                    console.log(result);
                    console.log(response);
                },
                templates: {
                    category: function (response) {
                        return template(response.results);
                    },
                },
                apiSettings: {
                    encodeParameters: true,
                    beforeXHR: function (xhr) {
                        xhr.setRequestHeader("api-key", "97FEC3C49C32A8B828370D33BB566BC9");
                    },
                    onResponse: function (githubResponse) {
                        var
                            response = {
                                results: {}
                            }
                            ;
                        // translate GitHub API response to work with search
                        $.each(githubResponse.value, function (index, item) {
                            var projectId = item.ProjectId || 'Unknown',
                                maxResults = 8
                                ;
                            var projectName = item.ProjectName;
                            if (index >= maxResults) {
                                return false;
                            }
                            // create new language category
                            if (response.results[projectId] === undefined) {
                                response.results[projectId] = {
                                    ProjectId: projectId,
                                    ProjectName: projectName,
                                    DemandSourceType: item.DemandSourceTypeEnum,
                                    requests: []
                                };
                            }
                            // add result to category
                            response.results[projectId].requests.push({
                                ResourceRequestId: item.ResourceRequestId,
                                Role: item.Role,
                                Country: item.DeliveryCountry
                            });
                        });
                        return response;
                    },
                    url: 'https://grm-search-dev.search.windows.net/indexes/asgn-index/docs/suggest?$select=*&suggestername=asgn-suggst&api-version=2016-09-01&search={query}'
                }
            });
    </script>


    <!-- <script type="text/javascript">
    if (document.addEventListener) { // IE >= 9; other browsers
        document.addEventListener('contextmenu', function(e) {
            alert("You've tried to open context menu"); //here you draw your own menu
            e.preventDefault();
        }, false);
    } else { // IE < 9
        document.attachEvent('oncontextmenu', function() {
            alert("You've tried to open context menu");
            window.event.returnValue = false;
        });
    }
</script> -->
</body>

</html>